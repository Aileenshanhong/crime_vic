{
    "contents" : "x <- read.csv(\"http://data.gov.au/storage/f/2013-05-12T201353/tmpZrsaL6PSA-Rates.csv\", stringsAsFactors = F)\n\n\n\n\n\n\n\n\nlibrary(reshape2)\nlibrary(cluster)\nlibrary(dplyr)\nlibrary(rCharts)\nlibrary(RColorBrewer)\n\nx <- read.csv(\"tmpZrsaL6PSA-Rates.csv\", stringsAsFactors = F)\ncrime <- dcast(x, PSA_NAME ~ LABEL, value.var = \"CURR\")\ncolnames(crime) <- tolower(colnames(crime))\nk1 <- clara(crime[,-1], k = 4)\n\nsuburbs <- read.csv(\"pc_full_lat_long.csv\", stringsAsFactors = F)\nsuburbs <- filter(suburbs, State == \"VIC\") %>%\n  select(Locality, Pcode, lat = Lat, lon = Long) %>%\n  group_by(Locality, Pcode) %>%\n  summarise(lat = median(lat), lon = median(lon))\n  \ncrime <- mutate(crime, cluster = k1$clustering, Locality = toupper(psa_name)) %>%\n  left_join(suburbs, by = \"Locality\")\n\n\ncolors <- data.frame(cluster = c(1:4), color = brewer.pal(4, \"Paired\"))\ncrime <- left_join(crime, colors, by = \"cluster\")\ncrime$popup <- paste0(\"<p>Suburb: \", crime$psa_name,\n                      \"<br>Cluster: \", crime$cluster,\n                      \"<br>Total Crime: \", crime$\"05_total crime\", \"</p>\")\ncrime$id <- crime$idx <- c(0: (nrow(crime)-1))\ncrime <- crime[complete.cases(crime),]\ncrimelist <- apply(crime, 1, as.list)\ncrimelist1 <- lapply(crimelist, function(row1){\n  psa_name = row1$\"psa_name\"\n  id = as.integer(row1$id)\n  idx = as.integer(row1$idx)\n  total_crime = as.numeric(row1$\"05_total crime\")\n  cluster = as.integer(row1$\"cluster\")\n  suburb = row1$Locality\n  postcode = row1$\"Pcode\"\n  lat = as.numeric(row1$lat)\n  lon = as.numeric(row1$lon)\n  color = row1$color\n  popup = row1$popup\n  return(list(psa_name = psa_name, idx = idx, total_crime = total_crime, cluster = cluster,\n              suburb = suburb, postcode = postcode, latitude = lat, longitude = lon, lat = NULL, lng = NULL, \n              id = id, fillColor = color, popup = popup))\n})\n\n\n\ncrime.map <- Leaflet$new()\ncrime.map$setView(c(-36.758106, 144.283042), zoom = 13)\ncrime.map$tileLayer(provider = 'Stamen.TonerLite')\ncrime.map$geoJson(toGeoJSON(crimelist1),\n                  onEachFeature = '#! function(feature, layer){\n                                   layer.bindPopup(feature.properties.popup)\n                                   } !#',\n                  pointToLayer = \"#! function(feature, latlng){\n                                 return L.circleMarker(latlng, {\n                                 radius: 5,\n                                 fillColor: feature.properties.fillColor || 'red', \n                                 color: '#000',\n                                 weight: 1,\n                                 fillOpacity: 0.8\n                                  })\n                                 } !#\" )\n\ncrime.map$set(width = 1600, height = 800)\ncrime.map$enablePopover(TRUE)\n#bus.map$publish('Bloomington IL Bus Stops', host = 'gist')\ncrime.map$save(\"index.html\", cdn=T)\n# cannot see colours\n\nL1$geoJson(toGeoJSON(data_), \n           onEachFeature = '#! function(feature, layer){\n      layer.bindPopup(feature.properties.popup)\n    } !#',\n           pointToLayer =  \"#! function(feature, latlng){\n      return L.circleMarker(latlng, {\n        radius: 4,\n        fillColor: feature.properties.fillColor || 'red',    \n        color: '#000',\n        weight: 1,\n        fillOpacity: 0.8\n      })\n    } !#\")\nL1$enablePopover(TRUE)\nL1$fullScreen(TRUE)\nreturn(L1)\n\n\n\n\n\nlibrary(rCharts)\nbus.map <- Leaflet$new()\nbus.map$setView(c(40.4739, -88.9719), zoom = 13)\nbus.map$tileLayer(provider = 'Stamen.TonerLite')\n# Add Data as GeoJSON Layer and Specify Popup and FillColor\nbus.map$geoJson(toGeoJSON(tmp.data, lat = 'lat', lon = 'lon'),\n                onEachFeature = '#! function(feature, layer){\n           layer.bindPopup(feature.properties.popup)\n           } !#',\n                pointToLayer =  \"#! function(feature, latlng){\n           return L.circleMarker(latlng, {\n           radius: 5,\n           fillColor: feature.properties.color || 'red', \n           color: '#000',\n           weight: 1,\n           fillOpacity: 0.8\n           })\n           } !#\"           \n)\nbus.map$set(width = 1600, height = 800)\nbus.map$enablePopover(TRUE)\n#bus.map$publish('Bloomington IL Bus Stops', host = 'gist')\nbus.map$save(\"index.html\", cdn=T)",
    "created" : 1419052714330.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3818916476",
    "id" : "5AFE5360",
    "lastKnownWriteTime" : 1419052834,
    "path" : "~/Downloads/crime_project/kmeans.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}